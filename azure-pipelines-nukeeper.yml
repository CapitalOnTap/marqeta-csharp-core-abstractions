# NuKeeper Pipeline
# This should
# - Run every Sunday morning
# - Run NuKeeper on the repository to automatically upgrade NuGet packages

# trigger: none # donâ€™t run as CI build

schedules:
- cron: "0 0 * * 0"
  displayName: Weekly on Sunday Morning
  branches:
    include:
    - master
  always: true

resources:
  - repo: self

pool:
  vmImage: 'ubuntu-18.04'

variables:
  githubRepositoryUrl: 'https://github.com/CapitalOnTap/marqeta-csharp-core-abstractions'

steps:
- task: PowerShell@2
  displayName: 'Install NuKeeper'
  inputs:
    failOnStderr: true
    targetType: 'inline'
    script: |
      dotnet new tool-manifest
      dotnet tool install nukeeper

- task: PowerShell@2
  displayName: 'Run NuKeeper for repository ''$(githubRepositoryUrl)'''
  inputs:
    failOnStderr: true
    targetType: 'inline'
    script:
      git config --global user.name 'NuKeeper'
      git config --global user.email 'nukeeper@nukeeper.com'
      dotnet nukeeper repo $(githubRepositoryUrl) $(Nukeeper_github_token)